<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
		<meta charset="utf-8">
		<title>Ground Overlays</title>
		<style>
			html, body, #map-canvas {
			        height: 100%;
			        margin: 0px;
			        padding: 0px
			      }
		</style>
		<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
		<script>
			// This example uses a GroundOverlay to place an image on the map
			// showing an antique map of Newark, NJ.

			var historicalOverlay = [];

			function initialize() {

				var newark = new google.maps.LatLng(52.5, 18);
				var imageBounds = new google.maps.LatLngBounds(
				new google.maps.LatLng(40.712216, -74.22655),
				new google.maps.LatLng(40.773941, -74.12544));


				var mapOptions = {
					zoom: 8,
					center: newark
				};

				window.map = new google.maps.Map(document.getElementById('map-canvas'),
				mapOptions);

				var icon = {
					url: 'http://localhost/images/impetIkona.png',
					scaledSize: new google.maps.Size(8, 8),
					anchor: new google.maps.Point(8, 8)

				}

				for (var x = 0; x < 5000; x++) {
					var lat = 49 + Math.random() * 5;
					var lng = 15 + Math.random() * 9;
					var ile = Math.random() / 30;
					/*  var imageBounds = new google.maps.LatLngBounds(
      new google.maps.LatLng(lat, lng),
      new google.maps.LatLng(lat+ile, lng+ile));

  historicalOverlay[x] = new google.maps.GroundOverlay(
      'http://localhost/images/impetIkona.png',
      imageBounds);
  historicalOverlay[x].setMap(map);
*/
					historicalOverlay[x] = new google.maps.Marker({
						map: map,
						position: new google.maps.LatLng(lat, lng),
						icon: icon
					})


				}
				window.markery = historicalOverlay;

				window.zoomChanged = false;
				google.maps.event.addListener(map, 'zoom_changed', zoomzmieniony);

				function zoomzmieniony() {
					zoomChanged = true;
					zoom = map.getZoom();


				}
				google.maps.event.addListener(map, 'idle', zoomIdle);

				function zoomIdle() {
					if (zoomChanged) {

						console.log('tak');
						markery.forEach(function(el) {
							el.icon.scaledSize.width =el.icon.scaledSize.height = Math.pow(2,(zoom-5));
							el.icon.anchor.y = el.icon.anchor.x = el.icon.scaledSize.width / 2;
							el.notify('icon')
						});
						//markery.forEach(function(el){el.notify('icon')})
					}
					zoomChanged = false;
				}


			}




			google.maps.event.addDomListener(window, 'load', initialize);


		</script>
	</head>
	<body>
		<div id="map-canvas"></div>
	</body>

</html>