<!DOCTYPE html>

<html lang="pl">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Wybierz miejscowosci</title>
	<link type="text/css" href="./css/ui.css" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="./css/theme.blue.css">
	<link type="text/css" href="./css/impet.css" rel="stylesheet">

	<style>
		html,
		body,
		#map-canvas {
			height: 100%;
			margin: 0px;
			padding: 0px
		}
	</style>

	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
	<script src="./js/jquery-1.10.2.js" type="text/javascript"></script>
	<script src="./js/jquery-ui.min.js" type="text/javascript"></script>
	<script>
		function initialize() {
			var mapOptions = {
				zoom: 7,
				center: new google.maps.LatLng(52, 18.944)
			};
			window.map = new google.maps.Map(document.getElementById('map-canvas'),
				mapOptions);

		}

		google.maps.event.addDomListener(window, 'load', initialize);
	</script>
</head>

<body>
	<div id="map-canvas"></div>
	<script>
		var czyWidoczne = true;
		var serwer = 'http://localhost';
		$.get(serwer + '/ajax/miasta2.php', function (data) {
			window.Miasta = JSON.parse(data);
			MiastaKontroler = {
				miasta: Miasta
			};
			MiastaKontroler.miastaId = [];
			MiastaKontroler.miasta.forEach(function (ele, ind, tab) {
				MiastaKontroler.miastaId[ele.id] = ele;
			});
			MiastaKontroler.options = {
				strokeColor: '#000',
				strokeOpacity: 1,
				strokeWeight: 1,
				fillColor: '#ff0000',
				fillOpacity: 0.14,
				visible: true,
				clickable: true,
				draggable:true
			};
			MiastaKontroler.wyswietl = function (czyWidoczne) {
				MiastaKontroler.options.map = map;
				czyWidoczne = (czyWidoczne === false) ? false : true;
				if (MiastaKontroler.miasta[0].circle) {
					MiastaKontroler.miasta.forEach(function (ele, ind, tab) {
						ele.circle.set('visible', czyWidoczne);
					});
					return;
				}
				var opt = Object.create(MiastaKontroler.options);
				var length = MiastaKontroler.miasta.length;
				for (var x = 0; x < length; x++) {
					var miasto = MiastaKontroler.miasta[x];
					if (miasto.ludnoscSuma < 50000) continue;
					opt.radius = Math.pow(miasto.ludnoscSuma, 0.5) * 10;
					opt.center = new google.maps.LatLng(miasto.wspN, miasto.wspE);
					miasto.circle = new google.maps.Circle(opt);
					miasto.circle.opt = opt;
					miasto.circle.set('title', miasto.nazwa);
					miasto.circle.addListener("mouseover",function(e){
						this.set('fillOpacity',1);
					})
					miasto.circle.addListener("mouseout",function(e){
						this.set('fillOpacity',0.3);
					})
				}
			};


			MiastaKontroler.changeOptions = function (optio) {
				if (!optio) {
					optio = MiastaKontroler.options;
				}
				var length = MiastaKontroler.miasta.length;
				for (var x = 0; x < length; x++) {
					MiastaKontroler.miasta[x].cityCircle.setOptions(optio);
				}
			};
			MiastaKontroler.wyswietl(true);
		});
	</script>
</body>

</html>
